<!DOCTYPE html>
<html>
<head>
  <base target="_top">
</head>
<body>


Cluster Sign Up
<br>
<br>
<div id = "studentName">
  Please write your name as it appears on your yellow sheet. 
  <br>
  <br>
  <form onsubmit="formSubmit(event)" >
    Family Name, First Name: <input type="text" value=" " name ="studentName" list="studentName-datalist" id = "studentName"/>
    <datalist id="studentName-datalist"></datalist>

    <input type="submit" onClick="formSubmit(event)" value = "Submit"/> <p>
  </form>
</div>
  
<div id="studentEmail">
</div>


<div id="radio" hidden= "hidden">
    <form id = "emailRadio">
      <input type="radio" name="email" id ="radioYes" value="yes"> yes<br>
      <input type="radio" name="email" id = "radioNo" value="no"> no<br>
      <input type="submit" onClick="formSubmit1(event)" value = "Submit"/> <p>

    </form>
</div>  
  
  
<div id = "clusterSignUp" hidden= "hidden">
  <p>Cluster Sign Up</p>
  <select id="selectCluster" >
    <option value="" disabled selected>Please select a cluster</option> 
  </select>
</div>
  
  
  
  
  
  
  <img src="http://app.lingsync.org/images/loading-spinner.gif" width="20" hidden=hidden id ="spinner" />



  <script  type="text/javascript">
  
  

 function onSuccess1(clusterList) { 
   var dropdown = document.getElementById("selectCluster");
    // Loop through the array
   for (var i = 0; i < clusterList.length; ++i) {
     //Append the element to the end of Array list
      dropdown[dropdown.length] = new Option(clusterList[i], clusterList[i]);
   }     
  }   
 
 
 function onSuccess2(studentList){ 
  var dataList = document.getElementById('studentName-datalist');
  var input = document.getElementById('studentName');    
    // Loop through the array
    for (var i = 0; i < studentList.length; ++i) {
     // Append the element to the end of Array list
      var option = document.createElement('option');
      // Set the value using the item in the JSON array.
      option.value = studentList[i];
      // Add the <option> element to the <datalist>.
      dataList.appendChild(option);
    }  
   }
 
 function onSuccess3(studentEmail){

   var div = document.getElementById("studentEmail");
   div.innerHTML =  "Is this your email? " +studentEmail;
      
   var spinner = document.getElementById("spinner");
   spinner.setAttribute("hidden", "hidden");
 
   var radio = document.getElementById("radio");
   radio.removeAttribute("hidden");

 }
 
      
 google.script.run.withSuccessHandler(onSuccess1).getClusterList();
 google.script.run.withSuccessHandler(onSuccess2).autoComplete();


 function formSubmit(event) {
      if (event) {
        event.preventDefault();
      }
      
      var spinner = document.getElementById("spinner");
      spinner.removeAttribute("hidden");
      google.script.run.withSuccessHandler(onSuccess3).getStudentEmail(document.forms[0]);
    }


 function formSubmit1(event) {
      if (event) {
        event.preventDefault();
      }
      var radioValue = document.getElementById("emailRadio").email.value;
     console.log(radioValue);
     
    if(radioValue === "yes"){
        var clusterSignUp = document.getElementById("clusterSignUp");
          clusterSignUp.removeAttribute("hidden");

    }
  if(radioValue === "no"){
      var div = document.createElement('div');

      document.body.appendChild(div);  
      div.innerHTML =  "Sorry that wasn't you! Please write your name in again!";
        


    }

}











  </script>

</body>
</html>



